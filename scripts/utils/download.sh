#!/bin/sh
echo "Setting up environment variables..."
set -o allexport
source ../../../../.env
set +o allexport
echo -e "Setting up environment variables... DONE\n"

# Define step counts array using proper bash syntax
STEP_COUNTS=(2520000
2550000
2580000
2610000
2640000
2670000
2700000
2730000
2760000
2790000
2820000
2850000
2880000
2910000
2940000
2970000
3000000
3030000
3060000
3090000
3120000
3150000
3180000
3210000
3240000
3270000
3300000
3330000
3360000
3390000
3420000
3450000
3480000
3510000
3540000
3570000
3600000
3630000
3660000
3690000
3720000
3750000
3780000
3810000
3840000
3870000
3900000
3930000
3960000
3990000
4020000
4050000
4080000
4110000
4140000
4170000
4200000
4230000
4260000
4290000
4320000
4350000
4380000
4410000
4440000
4470000
4500000
4530000
4560000
4590000
4620000
4650000
4680000
4710000
4740000
4770000
4800000
4830000
4860000
4890000
4920000
4950000
4980000
5010000
5040000
5070000
5100000
5130000
5160000
5190000
5220000
5250000
5280000
5310000
5340000
5370000
5400000
5430000
5460000
5490000
5520000
5550000
5580000
5610000
5640000
5670000
5700000
5730000
5760000
5790000
5820000
5850000
5880000
5910000
5940000
5970000
6000000
6030000
6060000
6090000
6120000
6150000
6180000
6210000
6240000
6270000
6300000
6330000
6360000
6390000
6420000
6450000
6480000
6510000
6540000
6570000
6600000
6630000
6660000
6690000
6720000
6750000
6780000
6810000
6840000
6870000)

# Loop through experiments and step counts
for i in {0..19}; do
    for j in "${STEP_COUNTS[@]}"; do
        echo "Downloading model_${i}_${j}.zip"
        OUTPUT_PATH="../../checkpoints/model_${i}_${j}.zip"
        rsync -avz -e ssh \
        "$CLUSTER_USER@$CLUSTER_HOST:/datasets/tbester/checkpoints/context-sensitive/CSAC_default_${i}_ee_15000/model_${j}_steps.zip" \
        "$OUTPUT_PATH"
    done
done




